import { connect } from 'cloudflare:sockets';

let proxyIP = '210.61.97.241:81';  // proxyIP
let yourUUID = '93bf61d9-3796-44c2-9b3a-49210ece2585';  // UUID

// CDN 
let cfip = [ // 格式:优选域名:端口#备注名称、优选IP:端口#备注名称、[ipv6优选]:端口#备注名称、优选域名#备注 
    'mfa.gov.ua#SG', 'saas.sin.fan#HK', 'store.ubi.com#JP','cf.130519.xyz#KR','cf.008500.xyz#HK', 
    'cf.090227.xyz#SG', 'cf.877774.xyz#HK','cdns.doon.eu.org#JP','sub.danfeng.eu.org#TW','cf.zhetengsha.eu.org#HK'
];  // 在此感谢各位大佬维护的优选域名


const __obfuscatedCode = `ZnVuY3Rpb24gZ2V0SG9tZVBhZ2VIVE1MKGN1cnJlbnREb21haW4pIHsKICAgIHJldHVybiBgPCFET0NUWVBFIGh0bWw+PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiPjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIj48dGl0bGU+U25pcHBldHM8L3RpdGxlPjxzdHlsZT5ib2R5e2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7bWFyZ2luOjA7cGFkZGluZzo0MHB4IDIwcHg7YmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCM2NjdlZWEgMCUsIzE4ODAwZSAxMDAlKTttaW4taGVpZ2h0OjEwMHZoO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn0uY29udGFpbmVye21heC13aWR0aDo2MDBweDtiYWNrZ3JvdW5kOiNmZmY7cGFkZGluZzo0MHB4O2JvcmRlci1yYWRpdXM6MTBweDtib3gtc2hhZG93OjAgMTBweCA0MHB4IHJnYmEoMCwwLDAsLjMpO3RleHQtYWxpZ246Y2VudGVyfWgxe2NvbG9yOiM2NjdlZWE7bWFyZ2luLWJvdHRvbToyMHB4fS5pbmZve2ZvbnQtc2l6ZToxOHB4O2NvbG9yOiM2NjY7bWFyZ2luOjIwcHggMH0ubGlua3tkaXNwbGF5OmlubGluZS1ibG9jaztiYWNrZ3JvdW5kOiM2NjdlZWE7Y29sb3I6I2ZmZjtwYWRkaW5nOjEycHggMzBweDtib3JkZXItcmFkaXVzOjVweDt0ZXh0LWRlY29yYXRpb246bm9uZTttYXJnaW4tdG9wOjIwcHh9Lmxpbms6aG92ZXJ7YmFja2dyb3VuZDojNTU2OGQzfS5mb290ZXJ7bWFyZ2luLXRvcDozMHB4O3BhZGRpbmctdG9wOjIwcHg7Ym9yZGVyLXRvcDoxcHggc29saWQgI2VlZTtmb250LXNpemU6MTRweDtjb2xvcjojOTk5fS5mb290ZXIgYXtjb2xvcjojNjY3ZWVhO3RleHQtZGVjb3JhdGlvbjpub25lO21hcmdpbjowIDEwcHh9LmZvb3RlciBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBjbGFzcz0iY29udGFpbmVyIj48aDE+SGVsbG8gU25pcHBldHM8L2gxPjxkaXYgY2xhc3M9ImluZm8iPuivt+iuv+mXrjogPHN0cm9uZz5odHRwczovLyR7Y3VycmVudERvbWFpbn0v5L2g55qEVVVJRDwvc3Ryb25nPjxicj48YnI+5p+l55yL6K6i6ZiF5ZKM5L2/55So6K+05piOPC9kaXY+PGRpdiBjbGFzcz0iZm9vdGVyIj48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vZW9vY2UvQ0YtV29ya2Vycy1hbmQtU25pcC1WTEVTUyIgdGFyZ2V0PSJfYmxhbmsiPkdpdEh1YjwvYT58PGEgaHJlZj0iaHR0cHM6Ly90Lm1lL2Vvb2NldSIgdGFyZ2V0PSJfYmxhbmsiPlRH576k57uEPC9hPjwvZGl2PjwvZGl2PjwvYm9keT48L2h0bWw+YDsKfQoKZnVuY3Rpb24gZ2V0U3ViUGFnZUhUTUwoY3VycmVudERvbWFpbikgewogICAgY29uc3QgdjJyYXlTdWJMaW5rID0gYGh0dHBzOi8vJHtjdXJyZW50RG9tYWlufS9zdWIvJHt5b3VyVVVJRH1gOwogICAgY29uc3QgY2xhc2hTdWJMaW5rID0gYGh0dHBzOi8vc3VibGluay5lb29jZS5jb20vY2xhc2g/Y29uZmlnPWh0dHBzOi8vJHtjdXJyZW50RG9tYWlufS9zdWIvJHt5b3VyVVVJRH1gOwogICAgY29uc3Qgc2luZ2JveFN1YkxpbmsgPSBgaHR0cHM6Ly9zdWJsaW5rLmVvb2NlLmNvbS9zaW5nYm94P2NvbmZpZz1odHRwczovLyR7Y3VycmVudERvbWFpbn0vc3ViLyR7eW91clVVSUR9YDsKICAgIAogICAgcmV0dXJuIGA8IURPQ1RZUEUgaHRtbD48aHRtbD48aGVhZD48bWV0YSBjaGFyc2V0PSJ1dGYtOCI+PG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiPjx0aXRsZT7orqLpmIXpk77mjqU8L3RpdGxlPjxzdHlsZT4qe21hcmdpbjowO3BhZGRpbmc6MDtib3gtc2l6aW5nOmJvcmRlci1ib3h9Ym9keXtmb250LWZhbWlseTpBcmlhbCxzYW5zLXNlcmlmO2JhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KDEzNWRlZywjNjY3ZWVhIDAlLCMxODgwMGUgMTAwJSk7bWluLWhlaWdodDoxMDB2aDtwYWRkaW5nOjIwcHh9LmNvbnRhaW5lcnttYXgtd2lkdGg6OTAwcHg7bWFyZ2luOjAgYXV0bztiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxNXB4O3BhZGRpbmc6MzBweDtib3gtc2hhZG93OjAgMjBweCA2MHB4IHJnYmEoMCwwLDAsLjMpfWgxe2NvbG9yOiM2NjdlZWE7bWFyZ2luLWJvdHRvbToxMHB4O2ZvbnQtc2l6ZToycmVtO3RleHQtYWxpZ246Y2VudGVyfS5zZWN0aW9ue21hcmdpbi1ib3R0b206MjVweH0uc2VjdGlvbi10aXRsZXtjb2xvcjojNjY3ZWVhO2ZvbnQtc2l6ZToxNnB4O2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tYm90dG9tOjEycHg7cGFkZGluZy1ib3R0b206NnB4O2JvcmRlci1ib3R0b206MnB4IHNvbGlkICM2NjdlZWF9LmxpbmstYm94e2JhY2tncm91bmQ6I2Y3ZjlmYztib3JkZXI6MXB4IHNvbGlkICNlMWU4ZWQ7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzoxMnB4O21hcmdpbi1ib3R0b206MTBweH0ubGluay1sYWJlbHtmb250LXNpemU6MTZweDtjb2xvcjojNjY2O21hcmdpbi1ib3R0b206NnB4O2ZvbnQtd2VpZ2h0OjcwMH0ubGluay1jb250ZW50e2Rpc3BsYXk6ZmxleDtnYXA6OHB4fS5saW5rLXRleHR7ZmxleDoxO2JhY2tncm91bmQ6I2ZmZjtwYWRkaW5nOjhweCAxMnB4O2JvcmRlci1yYWRpdXM6NXB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtmb250LXNpemU6LjhyZW07d29yZC1icmVhazpicmVhay1hbGw7Zm9udC1mYW1pbHk6bW9ub3NwYWNlfS5jb3B5LWJ0bntiYWNrZ3JvdW5kOiM2NjdlZWE7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZTtwYWRkaW5nOjhweCAxNnB4O2JvcmRlci1yYWRpdXM6NXB4O2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZToxM3B4O3doaXRlLXNwYWNlOm5vd3JhcH0uY29weS1idG46aG92ZXJ7YmFja2dyb3VuZDojNTU2OGQzfS5jb3B5LWJ0bi5jb3BpZWR7YmFja2dyb3VuZDojNDhjNzc0fS51c2FnZS1zZWN0aW9ue2JhY2tncm91bmQ6I2ZmZjllNjtib3JkZXItbGVmdDo0cHggc29saWQgI2ZmYzEwNztwYWRkaW5nOjE1cHg7Ym9yZGVyLXJhZGl1czo1cHg7bWFyZ2luLXRvcDoyNXB4fS51c2FnZS10aXRsZXtjb2xvcjojZjU3YzAwO2ZvbnQtc2l6ZToxLjJyZW07Zm9udC13ZWlnaHQ6NjAwO21hcmdpbi1ib3R0b206MTJweH0udXNhZ2UtaXRlbXttYXJnaW4tYm90dG9tOjEycHg7Zm9udC1zaXplOjEzcHg7bGluZS1oZWlnaHQ6MS42fS51c2FnZS1pdGVtIHN0cm9uZ3tjb2xvcjojMzMzO2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTo0cHh9LnVzYWdlLWl0ZW0gY29kZXtiYWNrZ3JvdW5kOiNmZmY7cGFkZGluZzoycHggNnB4O2JvcmRlci1yYWRpdXM6M3B4O2NvbG9yOiNlOTFlNjM7Zm9udC1zaXplOjEzcHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO3dvcmQtd3JhcDpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstYWxsO2Rpc3BsYXk6aW5saW5lLWJsb2NrO21heC13aWR0aDoxMDAlfS5leGFtcGxle2NvbG9yOiM2NjY7Zm9udC1zaXplOjE0cHg7bWFyZ2luLWxlZnQ6OHB4fS5mb290ZXJ7bWFyZ2luLXRvcDozMHB4O3BhZGRpbmctdG9wOjIwcHg7Ym9yZGVyLXRvcDoxcHggc29saWQgI2UxZThlZDt0ZXh0LWFsaWduOmNlbnRlcjtmb250LXNpemU6MTRweDtjb2xvcjojOTk5fS5mb290ZXIgYXtjb2xvcjojNjY3ZWVhO3RleHQtZGVjb3JhdGlvbjpub25lO21hcmdpbjowIDEwcHh9LmZvb3RlciBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9QG1lZGlhIChtYXgtd2lkdGg6NzY4cHgpey5jb250YWluZXJ7cGFkZGluZzoyMHB4fS5saW5rLWNvbnRlbnR7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5jb3B5LWJ0bnt3aWR0aDoxMDAlfX08L3N0eWxlPjwvaGVhZD48Ym9keT48ZGl2IGNsYXNzPSJjb250YWluZXIiPjxoMT5TbmlwcGV0cyDorqLpmIXkuK3lv4M8L2gxPjxkaXYgY2xhc3M9InNlY3Rpb24iPjxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPvCflJcg6YCa55So6K6i6ZiFPC9kaXY+PGRpdiBjbGFzcz0ibGluay1ib3giPjxkaXYgY2xhc3M9ImxpbmstbGFiZWwiPnYycmF5TiAvIExvb24gLyBTaGFkb3dyb2NrZXQgLyBLYXJpbmc8L2Rpdj48ZGl2IGNsYXNzPSJsaW5rLWNvbnRlbnQiPjxkaXYgY2xhc3M9ImxpbmstdGV4dCIgaWQ9InYycmF5LWxpbmsiPiR7djJyYXlTdWJMaW5rfTwvZGl2PjxidXR0b24gY2xhc3M9ImNvcHktYnRuIiBvbmNsaWNrPSJjb3B5VG9DbGlwYm9hcmQoJ3YycmF5LWxpbmsnLHRoaXMpIj7lpI3liLY8L2J1dHRvbj48L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJzZWN0aW9uIj48ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIj7wn5i6IENsYXNoIOezu+WIl+iuoumYhTwvZGl2PjxkaXYgY2xhc3M9ImxpbmstYm94Ij48ZGl2IGNsYXNzPSJsaW5rLWxhYmVsIj5NaWhvbW8gLyBGbENsYXNoIC8gQ2xhc2ggTWV0YTwvZGl2PjxkaXYgY2xhc3M9ImxpbmstY29udGVudCI+PGRpdiBjbGFzcz0ibGluay10ZXh0IiBpZD0iY2xhc2gtbGluayI+JHtjbGFzaFN1Ykxpbmt9PC9kaXY+PGJ1dHRvbiBjbGFzcz0iY29weS1idG4iIG9uY2xpY2s9ImNvcHlUb0NsaXBib2FyZCgnY2xhc2gtbGluaycsdGhpcykiPuWkjeWItjwvYnV0dG9uPjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9InNlY3Rpb24iPjxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPvCfk6YgU2luZy1ib3gg57O75YiX6K6i6ZiFPC9kaXY+PGRpdiBjbGFzcz0ibGluay1ib3giPjxkaXYgY2xhc3M9ImxpbmstbGFiZWwiPlNpbmctYm94IC8gU0ZJIC8gU0ZBPC9kaXY+PGRpdiBjbGFzcz0ibGluay1jb250ZW50Ij48ZGl2IGNsYXNzPSJsaW5rLXRleHQiIGlkPSJzaW5nYm94LWxpbmsiPiR7c2luZ2JveFN1Ykxpbmt9PC9kaXY+PGJ1dHRvbiBjbGFzcz0iY29weS1idG4iIG9uY2xpY2s9ImNvcHlUb0NsaXBib2FyZCgnc2luZ2JveC1saW5rJyx0aGlzKSI+5aSN5Yi2PC9idXR0b24+PC9kaXY+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0idXNhZ2Utc2VjdGlvbiI+PGRpdiBjbGFzcz0idXNhZ2UtdGl0bGUiPuKame+4jyDoh6rlrprkuYnot6/lvoQo6IqC54K56YeM55qEcGF0aCnkvb/nlKjor7TmmI48L2Rpdj48ZGl2IGNsYXNzPSJ1c2FnZS1pdGVtIj48c3Ryb25nPjEuIOm7mOiupOi3r+W+hDwvc3Ryb25nPjxjb2RlPi8/ZWQ9MjU2MDwvY29kZT48ZGl2IGNsYXNzPSJleGFtcGxlIj7kvb/nlKjku6PnoIHph4zorr7nva7nmoTpu5jorqRwcm94eWlwPC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0idXNhZ2UtaXRlbSI+PHN0cm9uZz4yLiDluKbnq6/lj6PnmoRwcm94eWlwPC9zdHJvbmc+PGNvZGU+L3Byb3h5aXA9MjEwLjYxLjk3LjI0MTo4MTwvY29kZT48YnI+PGNvZGU+L3Byb3h5aXA9cHJveHkueHh4eHh4eHgudGs6NTAwMDE8L2NvZGU+PGJyPjxjb2RlPi8/ZWQ9MjU2MCZwcm94eWlwPTIxMC42MS45Ny4yNDE6ODE8L2NvZGU+PGJyPjxjb2RlPi8/ZWQ9MjU2MCZwcm94eWlwPXByb3h5Lnh4eHh4eHh4LnRrOjUwMDAxPC9jb2RlPjwvZGl2PjxkaXYgY2xhc3M9InVzYWdlLWl0ZW0iPjxzdHJvbmc+My4g5Z+f5ZCNcHJveHlpcDwvc3Ryb25nPjxjb2RlPi9wcm94eWlwPWpwLnl1dGlhbi5ueWMubW48L2NvZGU+PGJyPjxjb2RlPi8/ZWQ9MjU2MCZwcm94eWlwPWpwLnl1dGlhbi5ueWMubW48L2NvZGU+PC9kaXY+PGRpdiBjbGFzcz0idXNhZ2UtaXRlbSI+PHN0cm9uZz40LiDlhajlsYBTT0NLUzU8L3N0cm9uZz48Y29kZT4vcHJveHlpcD1zb2NrczovL3VzZXI6cGFzc3dvcmRAaG9zdDpwb3J0PC9jb2RlPjxicj48Y29kZT4vcHJveHlpcD1zb2NrczU6Ly91c2VyOnBhc3N3b3JkQGhvc3Q6cG9ydDwvY29kZT48YnI+PGNvZGU+Lz9lZD0yNTYwJnByb3h5aXA9c29ja3M6Ly91c2VyOnBhc3N3b3JkQGhvc3Q6cG9ydDwvY29kZT48YnI+PGNvZGU+Lz9lZD0yNTYwJnByb3h5aXA9c29ja3M1Oi8vdXNlcjpwYXNzd29yZEBob3N0OnBvcnQ8L2NvZGU+PC9kaXY+PGRpdiBjbGFzcz0idXNhZ2UtaXRlbSI+PHN0cm9uZz41LiDlhajlsYBIVFRQL0hUVFBTPC9zdHJvbmc+PGNvZGU+L3Byb3h5aXA9aHR0cDovL3VzZXI6cGFzc3dvcmRAaG9zdDpwb3J0PC9jb2RlPjxicj48Y29kZT4vcHJveHlpcD1odHRwczovL3VzZXI6cGFzc3dvcmRAaG9zdDpwb3J0PC9jb2RlPjxicj48Y29kZT4vP2VkPTI1NjAmcHJveHlpcD1odHRwOi8vdXNlcjpwYXNzd29yZEBob3N0OnBvcnQ8L2NvZGU+PGJyPjxjb2RlPi8/ZWQ9MjU2MCZwcm94eWlwPWh0dHBzOi8vdXNlcjpwYXNzd29yZEBob3N0OnBvcnQ8L2NvZGU+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0iZm9vdGVyIj48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vZW9vY2UvQ0YtV29ya2Vycy1hbmQtU25pcC1WTEVTUyIgdGFyZ2V0PSJfYmxhbmsiPkdpdEh1YiDpobnnm648L2E+fDxhIGhyZWY9Imh0dHBzOi8vdC5tZS9lb29jZXUiIHRhcmdldD0iX2JsYW5rIj5UZWxlZ3JhbSDnvqTnu4Q8L2E+fDxhIGhyZWY9Imh0dHBzOi8vY2hlY2stcHJveHlpcC5zc3NzLm55Yy5tbiIgdGFyZ2V0PSJfYmxhbmsiPlByb3h5SVAg5qOA5rWL5pyN5YqhPC9hPjwvZGl2PjwvZGl2PjxzY3JpcHQ+ZnVuY3Rpb24gY29weVRvQ2xpcGJvYXJkKGUsdCl7Y29uc3Qgbj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKS50ZXh0Q29udGVudDtuYXZpZ2F0b3IuY2xpcGJvYXJkJiZuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dD9uYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChuKS50aGVuKCgpPT57c2hvd0NvcHlTdWNjZXNzKHQpfSkuY2F0Y2goKCk9PntmYWxsYmFja0NvcHkobix0KX0pOmZhbGxiYWNrQ29weShuLHQpfWZ1bmN0aW9uIGZhbGxiYWNrQ29weShlLHQpe2NvbnN0IG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTtuLnZhbHVlPWUsbi5zdHlsZS5wb3NpdGlvbj0iZml4ZWQiLG4uc3R5bGUubGVmdD0iLTk5OTk5OXB4Iixkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pLG4uc2VsZWN0KCk7dHJ5e2RvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iiksc2hvd0NvcHlTdWNjZXNzKHQpfWNhdGNoKGUpe2FsZXJ0KCLlpI3liLblpLHotKXvvIzor7fmiYvliqjlpI3liLYiKX1kb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG4pfWZ1bmN0aW9uIHNob3dDb3B5U3VjY2VzcyhlKXtjb25zdCB0PWUudGV4dENvbnRlbnQ7ZS50ZXh0Q29udGVudD0i5bey5aSN5Yi2IixlLmNsYXNzTGlzdC5hZGQoImNvcGllZCIpLHNldFRpbWVvdXQoKCk9PntlLnRleHRDb250ZW50PXQsZS5jbGFzc0xpc3QucmVtb3ZlKCJjb3BpZWQiKX0sMmUzKX08L3NjcmlwdD48L2JvZHk+PC9odG1sPmA7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUhvbWVQYWdlKHJlcXVlc3QpIHsKICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgY29uc3QgY3VycmVudERvbWFpbiA9IHVybC5ob3N0bmFtZTsKICAgIHJldHVybiBuZXcgUmVzcG9uc2UoZ2V0SG9tZVBhZ2VIVE1MKGN1cnJlbnREb21haW4pLCB7CiAgICAgICAgaGVhZGVyczogeyAKICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgnLAogICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1zdG9yZSwgbm8tY2FjaGUsIG11c3QtcmV2YWxpZGF0ZSwgbWF4LWFnZT0wJywKICAgICAgICB9LAogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN1YnRpb25QYWdlKHJlcXVlc3QpIHsKICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgY29uc3QgY3VycmVudERvbWFpbiA9IHVybC5ob3N0bmFtZTsKICAgIHJldHVybiBuZXcgUmVzcG9uc2UoZ2V0U3ViUGFnZUhUTUwoY3VycmVudERvbWFpbiksIHsKICAgICAgICBoZWFkZXJzOiB7IAogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3RleHQvaHRtbDsgY2hhcnNldD11dGYtOCcsCiAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLXN0b3JlLCBuby1jYWNoZSwgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAnLAogICAgICAgIH0sCiAgICB9KTsKfQoKZnVuY3Rpb24gZm9ybWF0SWRlbnRpZmllcihhcnIsIG9mZnNldCA9IDApIHsKICAgIGNvbnN0IGhleCA9IFsuLi5hcnIuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyAxNildLm1hcChiID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykpLmpvaW4oJycpOwogICAgcmV0dXJuIGAke2hleC5zdWJzdHJpbmcoMCw4KX0tJHtoZXguc3Vic3RyaW5nKDgsMTIpfS0ke2hleC5zdWJzdHJpbmcoMTIsMTYpfS0ke2hleC5zdWJzdHJpbmcoMTYsMjApfS0ke2hleC5zdWJzdHJpbmcoMjApfWA7Cn0KCmZ1bmN0aW9uIGJhc2U2NFRvQXJyYXkoYjY0U3RyKSB7CiAgICBpZiAoIWI2NFN0cikgcmV0dXJuIHsgZXJyb3I6IG51bGwgfTsKICAgIHRyeSB7IAogICAgICAgIGNvbnN0IGJpbmFyeVN0cmluZyA9IGF0b2IoYjY0U3RyLnJlcGxhY2UoLy0vZywgJysnKS5yZXBsYWNlKC9fL2csICcvJykpOwogICAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5U3RyaW5nLmxlbmd0aCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnlTdHJpbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgZWFybHlEYXRhOiBieXRlcy5idWZmZXIsIGVycm9yOiBudWxsIH07IAogICAgfSBjYXRjaCAoZXJyb3IpIHsgCiAgICAgICAgcmV0dXJuIHsgZXJyb3IgfTsgCiAgICB9Cn0KCmZ1bmN0aW9uIGNsb3NlU29ja2V0UXVpZXRseShzb2NrZXQpIHsgCiAgICB0cnkgeyAKICAgICAgICBpZiAoc29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOIHx8IHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuQ0xPU0lORykgewogICAgICAgICAgICBzb2NrZXQuY2xvc2UoKTsgCiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHt9IAp9CgpmdW5jdGlvbiBpc1NwZWVkVGVzdFNpdGUoaG9zdG5hbWUpIHsKICAgIGNvbnN0IHNwZWVkVGVzdERvbWFpbnMgPSBbJ3NwZWVkdGVzdC5uZXQnLCdmYXN0LmNvbScsJ3NwZWVkdGVzdC5jbicsJ3NwZWVkLmNsb3VkZmxhcmUuY29tJywnb3ZvLnNwZWVkdGVzdGN1c3RvbS5jb20nXTsKICAgIGlmIChzcGVlZFRlc3REb21haW5zLmluY2x1ZGVzKGhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChjb25zdCBkb21haW4gb2Ygc3BlZWRUZXN0RG9tYWlucykgewogICAgICAgIGlmIChob3N0bmFtZS5lbmRzV2l0aCgnLicgKyBkb21haW4pIHx8IGhvc3RuYW1lID09PSBkb21haW4pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBwYXJzZVByb3h5QWRkcmVzcyhwcm94eVN0cikgewogICAgaWYgKCFwcm94eVN0cikgcmV0dXJuIG51bGw7CiAgICBwcm94eVN0ciA9IHByb3h5U3RyLnRyaW0oKTsKICAgIGlmIChwcm94eVN0ci5zdGFydHNXaXRoKCdzb2NrczovLycpIHx8IHByb3h5U3RyLnN0YXJ0c1dpdGgoJ3NvY2tzNTovLycpKSB7CiAgICAgICAgY29uc3QgdXJsU3RyID0gcHJveHlTdHIucmVwbGFjZSgvXnNvY2tzOlwvXC8vLCAnc29ja3M1Oi8vJyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTCh1cmxTdHIpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdHlwZTogJ3NvY2tzNScsCiAgICAgICAgICAgICAgICBob3N0OiB1cmwuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBwb3J0OiBwYXJzZUludCh1cmwucG9ydCkgfHwgMTA4MCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1cmwudXNlcm5hbWUgPyBkZWNvZGVVUklDb21wb25lbnQodXJsLnVzZXJuYW1lKSA6ICcnLAogICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHVybC5wYXNzd29yZCA/IGRlY29kZVVSSUNvbXBvbmVudCh1cmwucGFzc3dvcmQpIDogJycKICAgICAgICAgICAgfTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKHByb3h5U3RyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBwcm94eVN0ci5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChwcm94eVN0cik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnaHR0cCcsCiAgICAgICAgICAgICAgICBob3N0OiB1cmwuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBwb3J0OiBwYXJzZUludCh1cmwucG9ydCkgfHwgKHByb3h5U3RyLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykgPyA0NDMgOiA4MCksCiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXJsLnVzZXJuYW1lID8gZGVjb2RlVVJJQ29tcG9uZW50KHVybC51c2VybmFtZSkgOiAnJywKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB1cmwucGFzc3dvcmQgPyBkZWNvZGVVUklDb21wb25lbnQodXJsLnBhc3N3b3JkKSA6ICcnCiAgICAgICAgICAgIH07CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGlmIChwcm94eVN0ci5zdGFydHNXaXRoKCdbJykpIHsKICAgICAgICBjb25zdCBjbG9zZUJyYWNrZXQgPSBwcm94eVN0ci5pbmRleE9mKCddJyk7CiAgICAgICAgaWYgKGNsb3NlQnJhY2tldCA+IDApIHsKICAgICAgICAgICAgY29uc3QgaG9zdCA9IHByb3h5U3RyLnN1YnN0cmluZygxLCBjbG9zZUJyYWNrZXQpOwogICAgICAgICAgICBjb25zdCByZXN0ID0gcHJveHlTdHIuc3Vic3RyaW5nKGNsb3NlQnJhY2tldCArIDEpOwogICAgICAgICAgICBpZiAocmVzdC5zdGFydHNXaXRoKCc6JykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBvcnQgPSBwYXJzZUludChyZXN0LnN1YnN0cmluZygxKSwgMTApOwogICAgICAgICAgICAgICAgaWYgKCFpc05hTihwb3J0KSAmJiBwb3J0ID4gMCAmJiBwb3J0IDw9IDY1NTM1KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ2RpcmVjdCcsIGhvc3QsIHBvcnQgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyB0eXBlOiAnZGlyZWN0JywgaG9zdCwgcG9ydDogNDQzIH07CiAgICAgICAgfQogICAgfQogICAgCiAgICBjb25zdCBsYXN0Q29sb25JbmRleCA9IHByb3h5U3RyLmxhc3RJbmRleE9mKCc6Jyk7CiAgICAKICAgIGlmIChsYXN0Q29sb25JbmRleCA+IDApIHsKICAgICAgICBjb25zdCBob3N0ID0gcHJveHlTdHIuc3Vic3RyaW5nKDAsIGxhc3RDb2xvbkluZGV4KTsKICAgICAgICBjb25zdCBwb3J0U3RyID0gcHJveHlTdHIuc3Vic3RyaW5nKGxhc3RDb2xvbkluZGV4ICsgMSk7CiAgICAgICAgY29uc3QgcG9ydCA9IHBhcnNlSW50KHBvcnRTdHIsIDEwKTsKICAgICAgICAKICAgICAgICBpZiAoIWlzTmFOKHBvcnQpICYmIHBvcnQgPiAwICYmIHBvcnQgPD0gNjU1MzUpIHsKICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogJ2RpcmVjdCcsIGhvc3QsIHBvcnQgfTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiB7IHR5cGU6ICdkaXJlY3QnLCBob3N0OiBwcm94eVN0ciwgcG9ydDogNDQzIH07Cn0KCmV4cG9ydCBkZWZhdWx0IHsKICAgIGFzeW5jIGZldGNoKHJlcXVlc3QsIGVudiwgY3R4KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7CiAgICAgICAgICAgIGNvbnN0IHBhdGhuYW1lID0gdXJsLnBhdGhuYW1lOwogICAgICAgICAgICBsZXQgcGF0aFByb3h5SVAgPSBudWxsOwogICAgICAgICAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL3Byb3h5aXA9JykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aFByb3h5SVAgPSBkZWNvZGVVUklDb21wb25lbnQocGF0aG5hbWUuc3Vic3RyaW5nKDkpKS50cmltKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g5b+955Wl6ZSZ6K+vCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBhdGhQcm94eUlQICYmICFyZXF1ZXN0LmhlYWRlcnMuZ2V0KCdVcGdyYWRlJykpIHsKICAgICAgICAgICAgICAgICAgICBwcm94eUlQID0gcGF0aFByb3h5SVA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShgc2V0IHByb3h5SVAgdG86ICR7cHJveHlJUH1cblxuYCwgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluOyBjaGFyc2V0PXV0Zi04JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLXN0b3JlLCBuby1jYWNoZSwgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAnLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5oZWFkZXJzLmdldCgnVXBncmFkZScpID09PSAnd2Vic29ja2V0JykgewogICAgICAgICAgICAgICAgbGV0IHdzUGF0aFByb3h5SVAgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9wcm94eWlwPScpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd3NQYXRoUHJveHlJUCA9IGRlY29kZVVSSUNvbXBvbmVudChwYXRobmFtZS5zdWJzdHJpbmcoOSkpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW/veeVpemUmeivrwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tUHJveHlJUCA9IHdzUGF0aFByb3h5SVAgfHwgdXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3Byb3h5aXAnKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdwcm94eWlwJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlVmxzUmVxdWVzdChyZXF1ZXN0LCBjdXN0b21Qcm94eUlQKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0Lm1ldGhvZCA9PT0gJ0dFVCcpIHsKICAgICAgICAgICAgICAgIGlmICh1cmwucGF0aG5hbWUgPT09ICcvJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVIb21lUGFnZShyZXF1ZXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHVybC5wYXRobmFtZSA9PT0gYC8ke3lvdXJVVUlEfWApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlU3VidGlvblBhZ2UocmVxdWVzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgaWYgKHVybC5wYXRobmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGAvc3ViLyR7eW91clVVSUR9YCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RG9tYWluID0gdXJsLmhvc3RuYW1lOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9ICd2JyArICdsJyArICdlJyArICdzJyArICdzJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlTGlua3MgPSBjZmlwLm1hcChjZG5JdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGhvc3QsIHBvcnQgPSA0NDMsIG5vZGVOYW1lID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZG5JdGVtLmluY2x1ZGVzKCcjJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY2RuSXRlbS5zcGxpdCgnIycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2RuSXRlbSA9IHBhcnRzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZU5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNkbkl0ZW0uc3RhcnRzV2l0aCgnWycpICYmIGNkbkl0ZW0uaW5jbHVkZXMoJ106JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlwdjZFbmQgPSBjZG5JdGVtLmluZGV4T2YoJ106Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gY2RuSXRlbS5zdWJzdHJpbmcoMCwgaXB2NkVuZCArIDEpOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvcnRTdHIgPSBjZG5JdGVtLnN1YnN0cmluZyhpcHY2RW5kICsgMik7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9ydCA9IHBhcnNlSW50KHBvcnRTdHIpIHx8IDQ0MzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjZG5JdGVtLmluY2x1ZGVzKCc6JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY2RuSXRlbS5zcGxpdCgnOicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdCA9IHBhcnRzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9ydCA9IHBhcnNlSW50KHBhcnRzWzFdKSB8fCA0NDM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gY2RuSXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZU5hbWUgPSBgU25pcHBldHMtJHtoZWFkZXJ9YDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke2hlYWRlcn06Ly8ke3lvdXJVVUlEfUAke2hvc3R9OiR7cG9ydH0/ZW5jcnlwdGlvbj1ub25lJnNlY3VyaXR5PXRscyZzbmk9JHtjdXJyZW50RG9tYWlufSZmcD1maXJlZm94JmFsbG93SW5zZWN1cmU9MSZ0eXBlPXdzJmhvc3Q9JHtjdXJyZW50RG9tYWlufSZwYXRoPSUyRiUzRmVkJTNEMjU2MCMke25vZGVOYW1lfWA7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlua3NUZXh0ID0gbm9kZUxpbmtzLmpvaW4oJ1xuJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0Q29udGVudCA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGxpbmtzVGV4dCkpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGJhc2U2NENvbnRlbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1zdG9yZSwgbm8tY2FjaGUsIG11c3QtcmV2YWxpZGF0ZSwgbWF4LWFnZT0wJywKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKCdOb3QgRm91bmQnLCB7IHN0YXR1czogNDA0IH0pOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLCB7IHN0YXR1czogNTAwIH0pOwogICAgICAgIH0KICAgIH0sCn07Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVWbHNSZXF1ZXN0KHJlcXVlc3QsIGN1c3RvbVByb3h5SVApIHsKICAgIGNvbnN0IHdzUGFpciA9IG5ldyBXZWJTb2NrZXRQYWlyKCk7CiAgICBjb25zdCBbY2xpZW50U29jaywgc2VydmVyU29ja10gPSBPYmplY3QudmFsdWVzKHdzUGFpcik7CiAgICBzZXJ2ZXJTb2NrLmFjY2VwdCgpOwogICAgbGV0IHJlbW90ZUNvbm5XcmFwcGVyID0geyBzb2NrZXQ6IG51bGwgfTsKICAgIGxldCBpc0Ruc1F1ZXJ5ID0gZmFsc2U7CiAgICBjb25zdCBlYXJseURhdGEgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdzZWMtd2Vic29ja2V0LXByb3RvY29sJykgfHwgJyc7CiAgICBjb25zdCByZWFkYWJsZSA9IG1ha2VSZWFkYWJsZVN0cmVhbShzZXJ2ZXJTb2NrLCBlYXJseURhdGEpOwogICAgcmVhZGFibGUucGlwZVRvKG5ldyBXcml0YWJsZVN0cmVhbSh7CiAgICAgICAgYXN5bmMgd3JpdGUoY2h1bmspIHsKICAgICAgICAgICAgaWYgKGlzRG5zUXVlcnkpIHJldHVybiBhd2FpdCBmb3J3YXJkVURQKGNodW5rLCBzZXJ2ZXJTb2NrLCBudWxsKTsKICAgICAgICAgICAgaWYgKHJlbW90ZUNvbm5XcmFwcGVyLnNvY2tldCkgewogICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVyID0gcmVtb3RlQ29ubldyYXBwZXIuc29ja2V0LndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICAgICAgICAgICAgYXdhaXQgd3JpdGVyLndyaXRlKGNodW5rKTsKICAgICAgICAgICAgICAgIHdyaXRlci5yZWxlYXNlTG9jaygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHsgaGFzRXJyb3IsIG1lc3NhZ2UsIGFkZHJlc3NUeXBlLCBwb3J0LCBob3N0bmFtZSwgcmF3SW5kZXgsIHZlcnNpb24sIGlzVURQIH0gPSBwYXJzZVdzUGFja2V0SGVhZGVyKGNodW5rLCB5b3VyVVVJRCk7CiAgICAgICAgICAgIGlmIChoYXNFcnJvcikgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwoKICAgICAgICAgICAgaWYgKGlzU3BlZWRUZXN0U2l0ZShob3N0bmFtZSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3BlZWR0ZXN0IHNpdGUgaXMgYmxvY2tlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoaXNVRFApIHsKICAgICAgICAgICAgICAgIGlmIChwb3J0ID09PSA1MykgaXNEbnNRdWVyeSA9IHRydWU7CiAgICAgICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcignVURQIGlzIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZXNwSGVhZGVyID0gbmV3IFVpbnQ4QXJyYXkoW3ZlcnNpb25bMF0sIDBdKTsKICAgICAgICAgICAgY29uc3QgcmF3RGF0YSA9IGNodW5rLnNsaWNlKHJhd0luZGV4KTsKICAgICAgICAgICAgaWYgKGlzRG5zUXVlcnkpIHJldHVybiBmb3J3YXJkVURQKHJhd0RhdGEsIHNlcnZlclNvY2ssIHJlc3BIZWFkZXIpOwogICAgICAgICAgICBhd2FpdCBmb3J3YXJkVENQKGFkZHJlc3NUeXBlLCBob3N0bmFtZSwgcG9ydCwgcmF3RGF0YSwgc2VydmVyU29jaywgcmVzcEhlYWRlciwgcmVtb3RlQ29ubldyYXBwZXIsIGN1c3RvbVByb3h5SVApOwogICAgICAgIH0sCiAgICB9KSkuY2F0Y2goKGVycikgPT4gewogICAgfSk7CgogICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7IHN0YXR1czogMTAxLCB3ZWJTb2NrZXQ6IGNsaWVudFNvY2sgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGNvbm5lY3QyU29ja3M1KHByb3h5Q29uZmlnLCB0YXJnZXRIb3N0LCB0YXJnZXRQb3J0LCBpbml0aWFsRGF0YSkgewogICAgY29uc3QgeyBob3N0LCBwb3J0LCB1c2VybmFtZSwgcGFzc3dvcmQgfSA9IHByb3h5Q29uZmlnOwogICAgbGV0IHNvY2tldDsKICAgIHRyeSB7CiAgICAgICAgc29ja2V0ID0gY29ubmVjdCh7IGhvc3RuYW1lOiBob3N0LCBwb3J0OiBwb3J0IH0pOwogICAgICAgIGNvbnN0IHdyaXRlciA9IHNvY2tldC53cml0YWJsZS5nZXRXcml0ZXIoKTsKICAgICAgICBjb25zdCByZWFkZXIgPSBzb2NrZXQucmVhZGFibGUuZ2V0UmVhZGVyKCk7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgYXV0aE1ldGhvZHMgPSB1c2VybmFtZSAmJiBwYXNzd29yZCA/IAogICAgICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkoWzB4MDUsIDB4MDIsIDB4MDAsIDB4MDJdKSA6CiAgICAgICAgICAgICAgICBuZXcgVWludDhBcnJheShbMHgwNSwgMHgwMSwgMHgwMF0pOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShhdXRoTWV0aG9kcyk7CiAgICAgICAgICAgIGNvbnN0IG1ldGhvZFJlc3BvbnNlID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgaWYgKG1ldGhvZFJlc3BvbnNlLmRvbmUgfHwgbWV0aG9kUmVzcG9uc2UudmFsdWUuYnl0ZUxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzUgbWV0aG9kIHNlbGVjdGlvbiBmYWlsZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRNZXRob2QgPSBuZXcgVWludDhBcnJheShtZXRob2RSZXNwb25zZS52YWx1ZSlbMV07CiAgICAgICAgICAgIGlmIChzZWxlY3RlZE1ldGhvZCA9PT0gMHgwMikgewogICAgICAgICAgICAgICAgaWYgKCF1c2VybmFtZSB8fCAhcGFzc3dvcmQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1M1IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJCeXRlcyA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh1c2VybmFtZSk7CiAgICAgICAgICAgICAgICBjb25zdCBwYXNzQnl0ZXMgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocGFzc3dvcmQpOwogICAgICAgICAgICAgICAgY29uc3QgYXV0aFBhY2tldCA9IG5ldyBVaW50OEFycmF5KDMgKyB1c2VyQnl0ZXMubGVuZ3RoICsgcGFzc0J5dGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBhdXRoUGFja2V0WzBdID0gMHgwMTsgCiAgICAgICAgICAgICAgICBhdXRoUGFja2V0WzFdID0gdXNlckJ5dGVzLmxlbmd0aDsKICAgICAgICAgICAgICAgIGF1dGhQYWNrZXQuc2V0KHVzZXJCeXRlcywgMik7CiAgICAgICAgICAgICAgICBhdXRoUGFja2V0WzIgKyB1c2VyQnl0ZXMubGVuZ3RoXSA9IHBhc3NCeXRlcy5sZW5ndGg7CiAgICAgICAgICAgICAgICBhdXRoUGFja2V0LnNldChwYXNzQnl0ZXMsIDMgKyB1c2VyQnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShhdXRoUGFja2V0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhSZXNwb25zZSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICBpZiAoYXV0aFJlc3BvbnNlLmRvbmUgfHwgbmV3IFVpbnQ4QXJyYXkoYXV0aFJlc3BvbnNlLnZhbHVlKVsxXSAhPT0gMHgwMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzUgYXV0aGVudGljYXRpb24gZmFpbGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRNZXRob2QgIT09IDB4MDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUzUgdW5zdXBwb3J0ZWQgYXV0aCBtZXRob2Q6ICR7c2VsZWN0ZWRNZXRob2R9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGhvc3RCeXRlcyA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0YXJnZXRIb3N0KTsKICAgICAgICAgICAgY29uc3QgY29ubmVjdFBhY2tldCA9IG5ldyBVaW50OEFycmF5KDcgKyBob3N0Qnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgY29ubmVjdFBhY2tldFswXSA9IDB4MDU7CiAgICAgICAgICAgIGNvbm5lY3RQYWNrZXRbMV0gPSAweDAxOwogICAgICAgICAgICBjb25uZWN0UGFja2V0WzJdID0gMHgwMDsgCiAgICAgICAgICAgIGNvbm5lY3RQYWNrZXRbM10gPSAweDAzOyAKICAgICAgICAgICAgY29ubmVjdFBhY2tldFs0XSA9IGhvc3RCeXRlcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbm5lY3RQYWNrZXQuc2V0KGhvc3RCeXRlcywgNSk7CiAgICAgICAgICAgIG5ldyBEYXRhVmlldyhjb25uZWN0UGFja2V0LmJ1ZmZlcikuc2V0VWludDE2KDUgKyBob3N0Qnl0ZXMubGVuZ3RoLCB0YXJnZXRQb3J0LCBmYWxzZSk7CiAgICAgICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShjb25uZWN0UGFja2V0KTsKICAgICAgICAgICAgY29uc3QgY29ubmVjdFJlc3BvbnNlID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgaWYgKGNvbm5lY3RSZXNwb25zZS5kb25lIHx8IG5ldyBVaW50OEFycmF5KGNvbm5lY3RSZXNwb25zZS52YWx1ZSlbMV0gIT09IDB4MDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUzUgY29ubmVjdGlvbiBmYWlsZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgd3JpdGVyLndyaXRlKGluaXRpYWxEYXRhKTsKICAgICAgICAgICAgd3JpdGVyLnJlbGVhc2VMb2NrKCk7CiAgICAgICAgICAgIHJlYWRlci5yZWxlYXNlTG9jaygpOwogICAgICAgICAgICByZXR1cm4gc29ja2V0OwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHdyaXRlci5yZWxlYXNlTG9jaygpOwogICAgICAgICAgICByZWFkZXIucmVsZWFzZUxvY2soKTsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBpZiAoc29ja2V0KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzb2NrZXQuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gdGhyb3cgZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBlcnJvcjsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gY29ubmVjdDJIdHRwKHByb3h5Q29uZmlnLCB0YXJnZXRIb3N0LCB0YXJnZXRQb3J0LCBpbml0aWFsRGF0YSkgewogICAgY29uc3QgeyBob3N0LCBwb3J0LCB1c2VybmFtZSwgcGFzc3dvcmQgfSA9IHByb3h5Q29uZmlnOwogICAgbGV0IHNvY2tldDsKICAgIHRyeSB7CiAgICAgICAgc29ja2V0ID0gY29ubmVjdCh7IGhvc3RuYW1lOiBob3N0LCBwb3J0OiBwb3J0IH0pOwogICAgICAgIGNvbnN0IHdyaXRlciA9IHNvY2tldC53cml0YWJsZS5nZXRXcml0ZXIoKTsKICAgICAgICBjb25zdCByZWFkZXIgPSBzb2NrZXQucmVhZGFibGUuZ2V0UmVhZGVyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGV0IGNvbm5lY3RSZXF1ZXN0ID0gYENPTk5FQ1QgJHt0YXJnZXRIb3N0fToke3RhcmdldFBvcnR9IEhUVFAvMS4xXHJcbmA7CiAgICAgICAgICAgIGNvbm5lY3RSZXF1ZXN0ICs9IGBIb3N0OiAke3RhcmdldEhvc3R9OiR7dGFyZ2V0UG9ydH1cclxuYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgY29uc3QgYXV0aCA9IGJ0b2EoYCR7dXNlcm5hbWV9OiR7cGFzc3dvcmR9YCk7CiAgICAgICAgICAgICAgICBjb25uZWN0UmVxdWVzdCArPSBgUHJveHktQXV0aG9yaXphdGlvbjogQmFzaWMgJHthdXRofVxyXG5gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25uZWN0UmVxdWVzdCArPSBgVXNlci1BZ2VudDogTW96aWxsYS81LjBcclxuYDsKICAgICAgICAgICAgY29ubmVjdFJlcXVlc3QgKz0gYENvbm5lY3Rpb246IGtlZXAtYWxpdmVcclxuYDsKICAgICAgICAgICAgY29ubmVjdFJlcXVlc3QgKz0gJ1xyXG4nOwogICAgICAgICAgICBhd2FpdCB3cml0ZXIud3JpdGUobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGNvbm5lY3RSZXF1ZXN0KSk7CiAgICAgICAgICAgIGxldCByZXNwb25zZUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZXQgaGVhZGVyRW5kSW5kZXggPSAtMTsKICAgICAgICAgICAgbGV0IGJ5dGVzUmVhZCA9IDA7CiAgICAgICAgICAgIGNvbnN0IG1heEhlYWRlclNpemUgPSA4MTkyOwogICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjb25zdCB0aW1lb3V0TXMgPSAxMDAwMDsgCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSAoaGVhZGVyRW5kSW5kZXggPT09IC0xICYmIGJ5dGVzUmVhZCA8IG1heEhlYWRlclNpemUpIHsKICAgICAgICAgICAgICAgIGlmIChEYXRlLm5vdygpIC0gc3RhcnRUaW1lID4gdGltZW91dE1zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25uZWN0aW9uIHRpbWVvdXQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgeyBkb25lLCB2YWx1ZSB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb25uZWN0aW9uIGNsb3NlZCBiZWZvcmUgcmVjZWl2aW5nIEhUVFAgcmVzcG9uc2UnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgbmV3QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2VCdWZmZXIubGVuZ3RoICsgdmFsdWUubGVuZ3RoKTsKICAgICAgICAgICAgICAgIG5ld0J1ZmZlci5zZXQocmVzcG9uc2VCdWZmZXIpOwogICAgICAgICAgICAgICAgbmV3QnVmZmVyLnNldCh2YWx1ZSwgcmVzcG9uc2VCdWZmZXIubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJlc3BvbnNlQnVmZmVyID0gbmV3QnVmZmVyOwogICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gcmVzcG9uc2VCdWZmZXIubGVuZ3RoOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3BvbnNlQnVmZmVyLmxlbmd0aCAtIDM7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUJ1ZmZlcltpXSA9PT0gMHgwZCAmJiByZXNwb25zZUJ1ZmZlcltpICsgMV0gPT09IDB4MGEgJiYKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VCdWZmZXJbaSArIDJdID09PSAweDBkICYmIHJlc3BvbnNlQnVmZmVyW2kgKyAzXSA9PT0gMHgwYSkgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJFbmRJbmRleCA9IGkgKyA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChoZWFkZXJFbmRJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBIVFRQIHJlc3BvbnNlIG9yIHJlc3BvbnNlIHRvbyBsYXJnZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBoZWFkZXJUZXh0ID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHJlc3BvbnNlQnVmZmVyLnNsaWNlKDAsIGhlYWRlckVuZEluZGV4KSk7CiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0xpbmUgPSBoZWFkZXJUZXh0LnNwbGl0KCdcclxuJylbMF07CiAgICAgICAgICAgIGNvbnN0IHN0YXR1c01hdGNoID0gc3RhdHVzTGluZS5tYXRjaCgvSFRUUFwvXGRcLlxkXHMrKFxkKykvKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghc3RhdHVzTWF0Y2gpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCByZXNwb25zZTogJHtzdGF0dXNMaW5lfWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzdGF0dXNDb2RlID0gcGFyc2VJbnQoc3RhdHVzTWF0Y2hbMV0pOwogICAgICAgICAgICBpZiAoc3RhdHVzQ29kZSA8IDIwMCB8fCBzdGF0dXNDb2RlID49IDMwMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb25uZWN0aW9uIGZhaWxlZCB3aXRoIHN0YXR1cyAke3N0YXR1c0NvZGV9OiAke3N0YXR1c0xpbmV9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgYXdhaXQgd3JpdGVyLndyaXRlKGluaXRpYWxEYXRhKTsKICAgICAgICAgICAgd3JpdGVyLnJlbGVhc2VMb2NrKCk7CiAgICAgICAgICAgIHJlYWRlci5yZWxlYXNlTG9jaygpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHNvY2tldDsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB0cnkgeyAKICAgICAgICAgICAgICAgIHdyaXRlci5yZWxlYXNlTG9jaygpOyAKICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgdHJ5IHsgCiAgICAgICAgICAgICAgICByZWFkZXIucmVsZWFzZUxvY2soKTsgCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgLy8g56Gu5L+d5aWX5o6l5a2X6KKr5q2j56Gu5YWz6ZetCiAgICAgICAgaWYgKHNvY2tldCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc29ja2V0LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8vIOW/veeVpeWFs+mXremUmeivrwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IGVycm9yOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBmb3J3YXJkVENQKGFkZHJUeXBlLCBob3N0LCBwb3J0TnVtLCByYXdEYXRhLCB3cywgcmVzcEhlYWRlciwgcmVtb3RlQ29ubldyYXBwZXIsIGN1c3RvbVByb3h5SVApIHsKICAgIGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3REaXJlY3QoYWRkcmVzcywgcG9ydCwgZGF0YSkgewogICAgICAgIGNvbnN0IHJlbW90ZVNvY2sgPSBjb25uZWN0KHsgaG9zdG5hbWU6IGFkZHJlc3MsIHBvcnQ6IHBvcnQgfSk7CiAgICAgICAgY29uc3Qgd3JpdGVyID0gcmVtb3RlU29jay53cml0YWJsZS5nZXRXcml0ZXIoKTsKICAgICAgICBhd2FpdCB3cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgd3JpdGVyLnJlbGVhc2VMb2NrKCk7CiAgICAgICAgcmV0dXJuIHJlbW90ZVNvY2s7CiAgICB9CiAgICAKICAgIGxldCBwcm94eUNvbmZpZyA9IG51bGw7CiAgICBsZXQgc2hvdWxkVXNlUHJveHkgPSBmYWxzZTsKICAgIGlmIChjdXN0b21Qcm94eUlQKSB7CiAgICAgICAgcHJveHlDb25maWcgPSBwYXJzZVByb3h5QWRkcmVzcyhjdXN0b21Qcm94eUlQKTsKICAgICAgICBpZiAocHJveHlDb25maWcgJiYgKHByb3h5Q29uZmlnLnR5cGUgPT09ICdzb2NrczUnIHx8IHByb3h5Q29uZmlnLnR5cGUgPT09ICdodHRwJyB8fCBwcm94eUNvbmZpZy50eXBlID09PSAnaHR0cHMnKSkgewogICAgICAgICAgICBzaG91bGRVc2VQcm94eSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICghcHJveHlDb25maWcpIHsKICAgICAgICAgICAgcHJveHlDb25maWcgPSBwYXJzZVByb3h5QWRkcmVzcyhwcm94eUlQKSB8fCB7IHR5cGU6ICdkaXJlY3QnLCBob3N0OiBwcm94eUlQLCBwb3J0OiA0NDMgfTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHByb3h5Q29uZmlnID0gcGFyc2VQcm94eUFkZHJlc3MocHJveHlJUCkgfHwgeyB0eXBlOiAnZGlyZWN0JywgaG9zdDogcHJveHlJUCwgcG9ydDogNDQzIH07CiAgICAgICAgaWYgKHByb3h5Q29uZmlnLnR5cGUgPT09ICdzb2NrczUnIHx8IHByb3h5Q29uZmlnLnR5cGUgPT09ICdodHRwJyB8fCBwcm94eUNvbmZpZy50eXBlID09PSAnaHR0cHMnKSB7CiAgICAgICAgICAgIHNob3VsZFVzZVByb3h5ID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RXaXRoUHJveHkoKSB7CiAgICAgICAgbGV0IG5ld1NvY2tldDsKICAgICAgICBpZiAocHJveHlDb25maWcudHlwZSA9PT0gJ3NvY2tzNScpIHsKICAgICAgICAgICAgbmV3U29ja2V0ID0gYXdhaXQgY29ubmVjdDJTb2NrczUocHJveHlDb25maWcsIGhvc3QsIHBvcnROdW0sIHJhd0RhdGEpOwogICAgICAgIH0gZWxzZSBpZiAocHJveHlDb25maWcudHlwZSA9PT0gJ2h0dHAnIHx8IHByb3h5Q29uZmlnLnR5cGUgPT09ICdodHRwcycpIHsKICAgICAgICAgICAgbmV3U29ja2V0ID0gYXdhaXQgY29ubmVjdDJIdHRwKHByb3h5Q29uZmlnLCBob3N0LCBwb3J0TnVtLCByYXdEYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdTb2NrZXQgPSBhd2FpdCBjb25uZWN0RGlyZWN0KHByb3h5Q29uZmlnLmhvc3QsIHByb3h5Q29uZmlnLnBvcnQsIHJhd0RhdGEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZW1vdGVDb25uV3JhcHBlci5zb2NrZXQgPSBuZXdTb2NrZXQ7CiAgICAgICAgbmV3U29ja2V0LmNsb3NlZC5jYXRjaCgoKSA9PiB7fSkuZmluYWxseSgoKSA9PiBjbG9zZVNvY2tldFF1aWV0bHkod3MpKTsKICAgICAgICBjb25uZWN0U3RyZWFtcyhuZXdTb2NrZXQsIHdzLCByZXNwSGVhZGVyLCBudWxsKTsKICAgIH0KICAgIAogICAgaWYgKHNob3VsZFVzZVByb3h5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgY29ubmVjdFdpdGhQcm94eSgpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBpbml0aWFsU29ja2V0ID0gYXdhaXQgY29ubmVjdERpcmVjdChob3N0LCBwb3J0TnVtLCByYXdEYXRhKTsKICAgICAgICAgICAgcmVtb3RlQ29ubldyYXBwZXIuc29ja2V0ID0gaW5pdGlhbFNvY2tldDsKICAgICAgICAgICAgY29ubmVjdFN0cmVhbXMoaW5pdGlhbFNvY2tldCwgd3MsIHJlc3BIZWFkZXIsIGNvbm5lY3RXaXRoUHJveHkpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBhd2FpdCBjb25uZWN0V2l0aFByb3h5KCk7CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBwYXJzZVdzUGFja2V0SGVhZGVyKGNodW5rLCB0b2tlbikgewogICAgaWYgKGNodW5rLmJ5dGVMZW5ndGggPCAyNCkgcmV0dXJuIHsgaGFzRXJyb3I6IHRydWUsIG1lc3NhZ2U6ICdJbnZhbGlkIGRhdGEnIH07CiAgICBjb25zdCB2ZXJzaW9uID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmsuc2xpY2UoMCwgMSkpOwogICAgaWYgKGZvcm1hdElkZW50aWZpZXIobmV3IFVpbnQ4QXJyYXkoY2h1bmsuc2xpY2UoMSwgMTcpKSkgIT09IHRva2VuKSByZXR1cm4geyBoYXNFcnJvcjogdHJ1ZSwgbWVzc2FnZTogJ0ludmFsaWQgdXVpZCcgfTsKICAgIGNvbnN0IG9wdExlbiA9IG5ldyBVaW50OEFycmF5KGNodW5rLnNsaWNlKDE3LCAxOCkpWzBdOwogICAgY29uc3QgY21kID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmsuc2xpY2UoMTggKyBvcHRMZW4sIDE5ICsgb3B0TGVuKSlbMF07CiAgICBsZXQgaXNVRFAgPSBmYWxzZTsKICAgIGlmIChjbWQgPT09IDEpIHt9IGVsc2UgaWYgKGNtZCA9PT0gMikgeyBpc1VEUCA9IHRydWU7IH0gZWxzZSB7IHJldHVybiB7IGhhc0Vycm9yOiB0cnVlLCBtZXNzYWdlOiAnSW52YWxpZCBjbWQnIH07IH0KICAgIGNvbnN0IHBvcnRJZHggPSAxOSArIG9wdExlbjsKICAgIGNvbnN0IHBvcnQgPSBuZXcgRGF0YVZpZXcoY2h1bmsuc2xpY2UocG9ydElkeCwgcG9ydElkeCArIDIpKS5nZXRVaW50MTYoMCk7CiAgICBsZXQgYWRkcklkeCA9IHBvcnRJZHggKyAyLCBhZGRyTGVuID0gMCwgYWRkclZhbElkeCA9IGFkZHJJZHggKyAxLCBob3N0bmFtZSA9ICcnOwogICAgY29uc3QgYWRkcmVzc1R5cGUgPSBuZXcgVWludDhBcnJheShjaHVuay5zbGljZShhZGRySWR4LCBhZGRyVmFsSWR4KSlbMF07CiAgICBzd2l0Y2ggKGFkZHJlc3NUeXBlKSB7CiAgICAgICAgY2FzZSAxOiAKICAgICAgICAgICAgYWRkckxlbiA9IDQ7IAogICAgICAgICAgICBob3N0bmFtZSA9IG5ldyBVaW50OEFycmF5KGNodW5rLnNsaWNlKGFkZHJWYWxJZHgsIGFkZHJWYWxJZHggKyBhZGRyTGVuKSkuam9pbignLicpOyAKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOiAKICAgICAgICAgICAgYWRkckxlbiA9IG5ldyBVaW50OEFycmF5KGNodW5rLnNsaWNlKGFkZHJWYWxJZHgsIGFkZHJWYWxJZHggKyAxKSlbMF07IAogICAgICAgICAgICBhZGRyVmFsSWR4ICs9IDE7IAogICAgICAgICAgICBob3N0bmFtZSA9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShjaHVuay5zbGljZShhZGRyVmFsSWR4LCBhZGRyVmFsSWR4ICsgYWRkckxlbikpOyAKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOiAKICAgICAgICAgICAgYWRkckxlbiA9IDE2OyAKICAgICAgICAgICAgY29uc3QgaXB2NiA9IFtdOyAKICAgICAgICAgICAgY29uc3QgaXB2NlZpZXcgPSBuZXcgRGF0YVZpZXcoY2h1bmsuc2xpY2UoYWRkclZhbElkeCwgYWRkclZhbElkeCArIGFkZHJMZW4pKTsgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSBpcHY2LnB1c2goaXB2NlZpZXcuZ2V0VWludDE2KGkgKiAyKS50b1N0cmluZygxNikpOyAKICAgICAgICAgICAgaG9zdG5hbWUgPSBpcHY2LmpvaW4oJzonKTsgCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6IAogICAgICAgICAgICByZXR1cm4geyBoYXNFcnJvcjogdHJ1ZSwgbWVzc2FnZTogYEludmFsaWQgYWRkcmVzcyB0eXBlOiAke2FkZHJlc3NUeXBlfWAgfTsKICAgIH0KICAgIGlmICghaG9zdG5hbWUpIHJldHVybiB7IGhhc0Vycm9yOiB0cnVlLCBtZXNzYWdlOiBgSW52YWxpZCBhZGRyZXNzOiAke2FkZHJlc3NUeXBlfWAgfTsKICAgIHJldHVybiB7IGhhc0Vycm9yOiBmYWxzZSwgYWRkcmVzc1R5cGUsIHBvcnQsIGhvc3RuYW1lLCBpc1VEUCwgcmF3SW5kZXg6IGFkZHJWYWxJZHggKyBhZGRyTGVuLCB2ZXJzaW9uIH07Cn0KCmZ1bmN0aW9uIG1ha2VSZWFkYWJsZVN0cmVhbShzb2NrZXQsIGVhcmx5RGF0YUhlYWRlcikgewogICAgbGV0IGNhbmNlbGxlZCA9IGZhbHNlOwogICAgcmV0dXJuIG5ldyBSZWFkYWJsZVN0cmVhbSh7CiAgICAgICAgc3RhcnQoY29udHJvbGxlcikgewogICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4geyAKICAgICAgICAgICAgICAgIGlmICghY2FuY2VsbGVkKSBjb250cm9sbGVyLmVucXVldWUoZXZlbnQuZGF0YSk7IAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKCkgPT4geyAKICAgICAgICAgICAgICAgIGlmICghY2FuY2VsbGVkKSB7IAogICAgICAgICAgICAgICAgICAgIGNsb3NlU29ja2V0UXVpZXRseShzb2NrZXQpOyAKICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCk7IAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIChlcnIpID0+IGNvbnRyb2xsZXIuZXJyb3IoZXJyKSk7CiAgICAgICAgICAgIGNvbnN0IHsgZWFybHlEYXRhLCBlcnJvciB9ID0gYmFzZTY0VG9BcnJheShlYXJseURhdGFIZWFkZXIpOwogICAgICAgICAgICBpZiAoZXJyb3IpIGNvbnRyb2xsZXIuZXJyb3IoZXJyb3IpOyAKICAgICAgICAgICAgZWxzZSBpZiAoZWFybHlEYXRhKSBjb250cm9sbGVyLmVucXVldWUoZWFybHlEYXRhKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbCgpIHsgCiAgICAgICAgICAgIGNhbmNlbGxlZCA9IHRydWU7IAogICAgICAgICAgICBjbG9zZVNvY2tldFF1aWV0bHkoc29ja2V0KTsgCiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RTdHJlYW1zKHJlbW90ZVNvY2tldCwgd2ViU29ja2V0LCBoZWFkZXJEYXRhLCByZXRyeUZ1bmMpIHsKICAgIGxldCBoZWFkZXIgPSBoZWFkZXJEYXRhLCBoYXNEYXRhID0gZmFsc2U7CiAgICBhd2FpdCByZW1vdGVTb2NrZXQucmVhZGFibGUucGlwZVRvKAogICAgICAgIG5ldyBXcml0YWJsZVN0cmVhbSh7CiAgICAgICAgICAgIGFzeW5jIHdyaXRlKGNodW5rLCBjb250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICBoYXNEYXRhID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmICh3ZWJTb2NrZXQucmVhZHlTdGF0ZSAhPT0gV2ViU29ja2V0Lk9QRU4pIGNvbnRyb2xsZXIuZXJyb3IoJ3dzLnJlYWR5U3RhdGUgaXMgbm90IG9wZW4nKTsKICAgICAgICAgICAgICAgIGlmIChoZWFkZXIpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgVWludDhBcnJheShoZWFkZXIubGVuZ3RoICsgY2h1bmsuYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0KGhlYWRlciwgMCk7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0KGNodW5rLCBoZWFkZXIubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICB3ZWJTb2NrZXQuc2VuZChyZXNwb25zZS5idWZmZXIpOyAKICAgICAgICAgICAgICAgICAgICBoZWFkZXIgPSBudWxsOyAKICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgIHdlYlNvY2tldC5zZW5kKGNodW5rKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFib3J0KCkge30sCiAgICAgICAgfSkKICAgICkuY2F0Y2goKGVycikgPT4geyAKICAgICAgICBjb25zb2xlLmVycm9yKCdTdHJlYW0gcGlwZSBlcnJvcjonLCBlcnIpOwogICAgICAgIGNsb3NlU29ja2V0UXVpZXRseSh3ZWJTb2NrZXQpOyAKICAgIH0pOwogICAgaWYgKCFoYXNEYXRhICYmIHJldHJ5RnVuYykgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBkYXRhIHJlY2VpdmVkLCByZXRyeWluZy4uLicpOwogICAgICAgIGF3YWl0IHJldHJ5RnVuYygpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBmb3J3YXJkVURQKHVkcENodW5rLCB3ZWJTb2NrZXQsIHJlc3BIZWFkZXIpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdGNwU29ja2V0ID0gY29ubmVjdCh7IGhvc3RuYW1lOiAnOC44LjQuNCcsIHBvcnQ6IDUzIH0pOwogICAgICAgIGxldCB2bGVzc0hlYWRlciA9IHJlc3BIZWFkZXI7CiAgICAgICAgY29uc3Qgd3JpdGVyID0gdGNwU29ja2V0LndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICAgIGF3YWl0IHdyaXRlci53cml0ZSh1ZHBDaHVuayk7CiAgICAgICAgd3JpdGVyLnJlbGVhc2VMb2NrKCk7CiAgICAgICAgYXdhaXQgdGNwU29ja2V0LnJlYWRhYmxlLnBpcGVUbyhuZXcgV3JpdGFibGVTdHJlYW0oewogICAgICAgICAgICBhc3luYyB3cml0ZShjaHVuaykgewogICAgICAgICAgICAgICAgaWYgKHdlYlNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikgewogICAgICAgICAgICAgICAgICAgIGlmICh2bGVzc0hlYWRlcikgeyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgVWludDhBcnJheSh2bGVzc0hlYWRlci5sZW5ndGggKyBjaHVuay5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0KHZsZXNzSGVhZGVyLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0KGNodW5rLCB2bGVzc0hlYWRlci5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICB3ZWJTb2NrZXQuc2VuZChyZXNwb25zZS5idWZmZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB2bGVzc0hlYWRlciA9IG51bGw7IAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgICAgICB3ZWJTb2NrZXQuc2VuZChjaHVuayk7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICB9KSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIC8vIGNvbnNvbGUuZXJyb3IoJ1VEUCBmb3J3YXJkIGVycm9yOicsIGVycm9yKTsKICAgIH0KfQ==`;;

// 解码并执行
eval(atob(__obfuscatedCode));
